# üîí –ü—Ä–æ–±–ª–µ–º–∞ CORS –ø—Ä–∏ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ GigaChat API

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ GigaChat API –∏–∑-–∑–∞ CORS –ø–æ–ª–∏—Ç–∏–∫–∏:
```
Access to fetch at 'https://ngw.devices.sberbank.ru:9443/api/v2/oauth' 
from origin 'http://localhost:8080' has been blocked by CORS policy
```

## üîç –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

### –ß—Ç–æ —Ç–∞–∫–æ–µ CORS?

CORS (Cross-Origin Resource Sharing) - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ –∫ –¥—Ä—É–≥–æ–º—É, **–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —è–≤–Ω–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã**.

### –ü–æ—á–µ–º—É cURL —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –±—Ä–∞—É–∑–µ—Ä - –Ω–µ—Ç?

- **cURL** - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞, –æ–Ω–∞ **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç CORS**
- **–ë—Ä–∞—É–∑–µ—Ä** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç CORS –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- GigaChat API **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS**, –ø–æ—ç—Ç–æ–º—É –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vite Proxy (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

Vite proxy —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ **—Å–µ—Ä–≤–µ—Ä–µ** (–Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ), –ø–æ—ç—Ç–æ–º—É CORS –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è.

–î–æ–±–∞–≤—å—Ç–µ –≤ `vite.config.ts`:
```typescript
server: {
  proxy: {
    '/api/gigachat-oauth': {
      target: 'https://ngw.devices.sberbank.ru:9443',
      changeOrigin: true,
      secure: false,
      rewrite: (path) => path.replace(/^\/api\/gigachat-oauth/, ''),
    },
    '/api/gigachat-api': {
      target: 'https://gigachat.devices.sberbank.ru',
      changeOrigin: true,
      secure: false,
      rewrite: (path) => path.replace(/^\/api\/gigachat-api/, ''),
    },
  },
}
```

–ò –≤ `gigachat.ts` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ URL:
```typescript
const GIGACHAT_OAUTH_URL = '/api/gigachat-oauth/api/v2/oauth';
const GIGACHAT_API_URL = '/api/gigachat-api/api/v1/chat/completions';
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Backend Proxy (–¥–ª—è production)

–°–æ–∑–¥–∞–π—Ç–µ Node.js —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (—Å–º. `backend/server.js`)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ "CORS Unblock" –∏–ª–∏ "Disable CORS"
- ‚ö†Ô∏è **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ** - —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ó–∞–ø—É—Å–∫ Chrome —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–π CORS (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
# Windows
chrome.exe --user-data-dir="C:/Chrome dev" --disable-web-security

# Mac
open -na Google\ Chrome --args --user-data-dir=/tmp/chrome_dev --disable-web-security
```

## üö´ –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏ CORS –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞?

CORS - —ç—Ç–æ **–ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞**. –ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ `Access-Control-Allow-Origin` –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –±—Ä–∞—É–∑–µ—Ä **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å.

–≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç –º–µ–∂—Å–∞–π—Ç–æ–≤—ã—Ö –∞—Ç–∞–∫ (XSS).

## üìã –ò—Ç–æ–≥

**–î–ª—è —Ä–∞–±–æ—Ç—ã —Å GigaChat API –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω—É–∂–µ–Ω –ø—Ä–æ–∫—Å–∏**, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. GigaChat API –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
2. –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ CORS –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
3. –≠—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞, –µ–≥–æ –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Vite proxy –¥–ª—è development –∏ backend proxy –¥–ª—è production.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
