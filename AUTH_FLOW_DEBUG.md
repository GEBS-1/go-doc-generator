# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Å—ã–ª–∫–µ `https://go-doc-generator.onrender.com/auth?token=...` –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

## Flow –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 1. –ë–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω
- –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç UUID —Ç–æ–∫–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ `auth_tokens`
- –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω 5 –º–∏–Ω—É—Ç
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É: `https://go-doc-generator.onrender.com/auth?token=<uuid>`

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
- Frontend –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É `/auth`
- React Router –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `Auth.tsx` –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ URL

### 3. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω –Ω–∞ backend
- POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/auth/telegram-token`
- URL —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è: `VITE_BACKEND_URL + /api/auth/telegram-token`
- –í production: `https://go-doc-generator-backend.onrender.com/api/auth/telegram-token`

### 4. Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ –ë–î (`auth_tokens`)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (`expires_at > CURRENT_TIMESTAMP`)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω (`used = FALSE`)
- –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `telegram_id`
- –°–æ–∑–¥–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω
- –ü–æ–º–µ—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π

### 5. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç
```json
{
  "success": true,
  "token": "jwt_token_here",
  "user": { ... }
}
```

### 6. Frontend –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç JWT –≤ `localStorage`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `user` –≤ `AuthContext`
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–±–ª–µ–º

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console –∏ –Ω–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏:
```
[Auth] ===== –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò =====
[Auth] URL: https://go-doc-generator.onrender.com/auth?token=...
[Auth] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞: { backendUrl: ..., fullUrl: ... }
[apiFetch] –ó–∞–ø—Ä–æ—Å: { url: ..., method: 'POST' }
[apiFetch] –û—Ç–≤–µ—Ç: { status: ..., ok: ... }
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network
- –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/auth/telegram-token`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
  - **Status**: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 200 (OK)
  - **Request URL**: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://go-doc-generator-backend.onrender.com/api/auth/telegram-token`
  - **Request Payload**: –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `{ "token": "..." }`
  - **Response**: –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `{ "success": true, "token": "...", "user": {...} }`

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render
**Frontend (Static Site):**
- –û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard ‚Üí Frontend Service ‚Üí Environment
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
  ```
  VITE_BACKEND_URL=https://go-doc-generator-backend.onrender.com
  ```
- ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å **Manual Deploy** (Vite –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ!)

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
**Backend (Web Service):**
- –û—Ç–∫—Ä–æ–π—Ç–µ Render Dashboard ‚Üí Backend Service ‚Üí Logs
- –ù–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏:
  ```
  [Auth] –ó–∞–ø—Ä–æ—Å –Ω–∞ /api/auth/telegram-token –ø–æ–ª—É—á–µ–Ω: { ... }
  [Auth] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –æ—Ç –±–æ—Ç–∞: { ... }
  [Auth] –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: { ... }
  ```

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: 404 –æ—à–∏–±–∫–∞
**–°–∏–º–ø—Ç–æ–º—ã:**
- –í Network tab —Å—Ç–∞—Ç—É—Å 404
- –í –∫–æ–Ω—Å–æ–ª–∏: `Failed to load resource: 404`

**–ü—Ä–∏—á–∏–Ω—ã:**
1. `VITE_BACKEND_URL` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ Render
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL backend
3. Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `VITE_BACKEND_URL` –Ω–∞ Render (Frontend)
2. –°–¥–µ–ª–∞–π—Ç–µ Manual Deploy –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –¥–æ—Å—Ç—É–ø–µ–Ω: `https://go-doc-generator-backend.onrender.com/health`

### –ü—Ä–æ–±–ª–µ–º–∞ 2: CORS –æ—à–∏–±–∫–∞
**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏: `Access to fetch at '...' from origin '...' has been blocked by CORS policy`
- –í Network tab —Å—Ç–∞—Ç—É—Å –º–æ–∂–µ—Ç –±—ã—Ç—å 200, –Ω–æ –∑–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

**–ü—Ä–∏—á–∏–Ω—ã:**
1. `ALLOWED_ORIGINS` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç frontend URL
2. Backend –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS headers

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `ALLOWED_ORIGINS` –Ω–∞ Render (Backend):
   ```
   ALLOWED_ORIGINS=https://go-doc-generator.onrender.com
   ```
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏: `–¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫`
- –í Network tab —Å—Ç–∞—Ç—É—Å 401

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ (5 –º–∏–Ω—É—Ç)
2. –¢–æ–∫–µ–Ω —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
3. –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –±–æ—Ç–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (`/start`)
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/auth` –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (404)
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Å—ã–ª–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è 404
- React Router –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç

**–ü—Ä–∏—á–∏–Ω—ã:**
1. Render –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SPA routing
2. –§–∞–π–ª `_redirects` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Render

**–†–µ—à–µ–Ω–∏–µ:**
Render –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∞–π—Ç–æ–≤ **–ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç** —Ñ–∞–π–ª `_redirects` (—ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç Netlify).

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Hash Router –≤–º–µ—Å—Ç–æ Browser Router (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ redirects —á–µ—Ä–µ–∑ Render Dashboard (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç–∏–Ω–≥ –¥–ª—è frontend (Vercel, Netlify)

## ‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

1. **–ë–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω:**
   ```
   [Telegram Bot] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: { token: '...', telegramId: ..., expiresAt: '...' }
   ```

2. **Frontend –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω:**
   ```
   [Auth] ===== –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò =====
   [Auth] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞ –æ—Ç –±–æ—Ç–∞: { hasToken: true, tokenLength: 36 }
   ```

3. **–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
   ```
   [apiFetch] –ó–∞–ø—Ä–æ—Å: { url: 'https://go-doc-generator-backend.onrender.com/api/auth/telegram-token', method: 'POST' }
   ```

4. **Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç:**
   ```
   [Auth] –ó–∞–ø—Ä–æ—Å –Ω–∞ /api/auth/telegram-token –ø–æ–ª—É—á–µ–Ω: { ... }
   [Auth] –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: { userId: ..., telegramId: ... }
   ```

5. **Frontend –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
   ```
   [Auth] ‚úÖ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω: { success: true, hasToken: true, hasUser: true }
   [Auth] ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
   [AuthContext] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: { hasToken: true, hasUser: true, userId: ... }
   ```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Å—ã–ª–∫–µ
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ –ª–æ–≥–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[Auth]` –∏ `[apiFetch]`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab - –∫–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞?
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –Ω–∞ Render
5. –ü—Ä–∏—à–ª–∏—Ç–µ –≤—Å–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

