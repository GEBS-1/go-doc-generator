# üß™ –ü–æ—à–∞–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π YooKassa

## üìã –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend

### ‚úÖ –î–ª—è –õ–û–ö–ê–õ–¨–ù–û–ì–û —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

**–ù–ï –Ω–∞ Render!** –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ.

#### Windows (PowerShell):
```bash
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –ø–∞–ø–∫–µ backend
cd backend

# 2. –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–∂–µ –∑–∞–ø—É—â–µ–Ω, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ (Ctrl+C)

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞
npm run dev
```

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª):
```bash
# –ü—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
npm run dev
```

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```
> docugen-backend@1.0.0 dev
> nodemon server.js

[nodemon] starting `node server.js`
[Server] Backend server started on port 3001
```

---

### üåê –î–ª—è PRODUCTION (Render):

–ï—Å–ª–∏ –≤—ã —É–∂–µ –∑–∞–¥–µ–ø–ª–æ–∏–ª–∏ backend –Ω–∞ Render:
1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ Render
2. –û–±–Ω–æ–≤–∏—Ç–µ Environment Variables (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
3. –ù–∞–∂–º–∏—Ç–µ **"Manual Deploy"** ‚Üí **"Deploy latest commit"**

**–ò–õ–ò** –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–æ–º–º–∏—Ç –∏ –ø—É—à - Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.

---

## üí≥ –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã

### ‚úÖ –î–∞, —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É –Ω—É–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ YooKassa

### üìù –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

#### 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç
```
http://localhost:8080
```

#### 2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram
- –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
- –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å

#### 3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏
- –ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å" –Ω–∞ –ø–ª–∞—Ç–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ë–∞–∑–æ–≤—ã–π" - 199 ‚ÇΩ)

#### 4. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ YooKassa
–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–û–ø–ª–∞—Ç–∏—Ç—å":
- Frontend –æ—Ç–ø—Ä–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ `POST /api/payments/create`
- Backend —Å–æ–∑–¥–∞—Å—Ç –ø–ª–∞—Ç–µ–∂ –∏ –≤–µ—Ä–Ω–µ—Ç `confirmationUrl`
- –ü—Ä–æ–∏–∑–æ–π–¥–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É YooKassa

#### 5. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã YooKassa
–í—ã —É–≤–∏–¥–∏—Ç–µ —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã YooKassa:
- –ü–æ–ª–µ –¥–ª—è –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
- –ü–æ–ª–µ –¥–ª—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –ü–æ–ª–µ –¥–ª—è CVC
- –ü–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ –¥–µ—Ä–∂–∞—Ç–µ–ª—è

**–í–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- **–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã**: `5555555555554444`
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**: `12/25` (–∏–ª–∏ –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞)
- **CVC**: `123` (–ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã)
- **–ò–º—è**: –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `Test User`)

#### 6. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–ø–ª–∞—Ç—É
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û–ø–ª–∞—Ç–∏—Ç—å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ YooKassa
- –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ

#### 7. –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å–∞–π—Ç
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã YooKassa –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –≤–∞—Å –Ω–∞:
```
http://localhost:8080/payment/success
```

–í—ã —É–≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É:
```
‚úÖ –û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞
–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞...
```

---

## üé¨ –í–∏–¥–µ–æ-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è):

```
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend –ª–æ–∫–∞–ª—å–Ω–æ:
   cd backend
   npm run dev

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ frontend (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
   npm run dev

3. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä:
   http://localhost:8080

4. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram

5. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ ‚Üí "–û–ø–ª–∞—Ç–∏—Ç—å"

6. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ YooKassa –≤–≤–µ–¥–∏—Ç–µ:
   –ö–∞—Ä—Ç–∞: 5555555555554444
   –°—Ä–æ–∫: 12/25
   CVC: 123

7. –ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å"

8. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ /payment/success
   ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
   ‚úÖ –õ–æ–≥–∏ backend –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

### –í –±—Ä–∞—É–∑–µ—Ä–µ:
- ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ `/payment/success`
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ "–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞"

### –í –ª–æ–≥–∞—Ö backend:
–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
```
[Payments] Creating payment for plan: basic
[Payments] Payment created: 2c8cb95e-0001-5000-8000-...
[Payments] Webhook received: payment.succeeded
[Payments] Payment successful, activating subscription...
```

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É subscriptions
SELECT * FROM subscriptions ORDER BY activated_at DESC LIMIT 1;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
-- plan: 'basic'
-- status: 'active'
-- docs_limit: 5
```

---

## ‚ùå –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ü—Ä–æ–±–ª–µ–º–∞: "–ü–ª–∞—Ç—ë–∂–Ω—ã–π —à–ª—é–∑ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `backend/.env` –µ—Å—Ç—å `YOOKASSA_SHOP_ID` –∏ `YOOKASSA_SECRET_KEY`

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ YooKassa
**–†–µ—à–µ–Ω–∏–µ**: 
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) ‚Üí –≤–∫–ª–∞–¥–∫–∞ Console
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ JavaScript
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/payments/create`

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `confirmationUrl` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–µ API
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å `confirmationUrl` –≤—Ä—É—á–Ω—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –û–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **—Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏** (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `test_`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∞–≥–∞–∑–∏–Ω –≤ YooKassa –≤ **—Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: `5555555555554444` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã!)

---

## üéØ –ò—Ç–æ–≥–æ:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend**: –õ–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `npm run dev` (–ù–ï –Ω–∞ Render –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
2. **–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞**: –í–≤–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ YooKassa –ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. **–ü—Ä–æ—Ü–µ—Å—Å**: –í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ ‚Üí –û–ø–ª–∞—Ç–∏—Ç—å ‚Üí –í–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å

–£–¥–∞—á–∏ –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏! üöÄ

